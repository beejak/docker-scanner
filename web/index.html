<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Docker Container Scanner</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 640px; margin: 2rem auto; padding: 0 1rem; line-height: 1.5; }
    h1 { font-size: 1.5rem; }
    ul { padding-left: 1.25rem; }
    a { color: #0066cc; }
    code { background: #f0f0f0; padding: 0.15em 0.4em; border-radius: 3px; font-size: 0.9em; }
    .box { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 1rem; margin: 1rem 0; }
  </style>
</head>
<body>
  <h1>Docker Container Scanner</h1>
  <p>CI/CD-ready container scanner: Trivy-based scans, SARIF/Markdown/HTML reports, remediation guidance, and pipeline integration.</p>

  <div class="box">
    <strong>Quick start (CLI)</strong>
    <ul>
      <li><strong>Docker:</strong> <code>docker run --rm -v %CD%\reports:/reports scanner:latest scan --image alpine:latest --output-dir /reports</code></li>
      <li><strong>From source:</strong> <code>go build -o scanner ./cmd/cli</code> then <code>./scanner scan --image alpine:latest --output-dir ./reports</code></li>
      <li><strong>Windows (no PATH):</strong> <code>scripts\run-scan-local.bat</code> — reports in <code>reports\</code>. Add <code>/publish</code> to open the report in the browser after the scan.</li>
      <li><strong>Test with many vulns:</strong> <code>scripts\run-scan-local.bat ghcr.io/chainguard-dev/maxcve/maxcve:latest</code> (1–2 min scan, tens of thousands of findings).</li>
    </ul>
  </div>

  <p><strong>Docs</strong></p>
  <ul>
    <li><a href="../docs/HELP.md">Help</a> — plain-language intro, PATH, Trivy DB, drag-and-drop (image or rootfs/LXC)</li>
    <li><a href="../docs/getting-started.md">Getting started</a> — install deps, first scan</li>
    <li><a href="../docs/baseline.md">Baseline</a> — scan many images, dashboard</li>
    <li><a href="../docs/image-sources.md">Image sources</a> — registries and lists</li>
    <li><a href="../docs/hardened-images-and-local-registries.md">Hardened images & local registries</a> — your own repo, microservices</li>
    <li><a href="../docs/ci-cd-primer.md">CI/CD primer</a> — add to pipelines</li>
    <li><a href="../docs/cli-reference.md">CLI reference</a> — commands and flags</li>
    <li><a href="../docs/ide-and-mcp.md">IDE plugins & MCP server</a> — VS Code, JetBrains, Cursor/AI</li>
    <li><a href="../docs/sanity.md">Sanity checklist</a> — pre-PR checks</li>
    <li><a href="../docs/testing.md">Testing</a> — unit and integration tests</li>
  </ul>

  <p><strong>Latest HTML report:</strong> <a href="../reports/report.html">Open report.html</a> (after running a scan). Reports are in the <code>reports\</code> folder at the repo root.</p>
  <p><strong>Publish report:</strong> Run <code>scripts\serve-report.bat</code> to serve at <code>http://localhost:8080/reports/report.html</code>.</p>

  <div class="box">
    <strong>Drag & drop – image or rootfs to scan</strong>
    <p>Choose <strong>Image</strong> (Docker/Podman), <strong>Rootfs path</strong>, or <strong>LXC name</strong>. Drop or paste in the box; the page shows the exact command.</p>
    <p style="margin:0.5rem 0 0.25rem 0;">
      <label>Scan mode: </label>
      <select id="scanMode" style="padding:0.25rem;">
        <option value="image">Image (Docker/Podman)</option>
        <option value="fs">Rootfs path (e.g. LXC)</option>
        <option value="lxc">LXC container name (Linux)</option>
      </select>
    </p>
    <div id="dropzone" style="border:2px dashed #0066cc; padding:1.5rem; text-align:center; margin:0.5rem 0; min-height:60px; background:#f0f8ff; cursor:pointer;">
      Drop here or click and paste
    </div>
    <input type="text" id="imageRef" placeholder="e.g. alpine:3.10 or /var/lib/lxc/mycontainer/rootfs" style="width:100%; padding:0.5rem; margin:0.5rem 0; box-sizing:border-box;" />
    <p style="margin:0.5rem 0 0.25rem 0;"><strong>From source (binary):</strong></p>
    <p id="cliCommand" style="font-family:monospace; background:#f0f0f0; padding:0.5rem; margin:0.25rem 0; word-break:break-all;"></p>
    <button type="button" id="copyCli" style="margin:0.25rem 0; padding:0.25rem 0.5rem; display:none;">Copy command</button>
    <p style="margin:0.5rem 0 0.25rem 0;"><strong>Docker:</strong></p>
    <p id="dockerCommand" style="font-family:monospace; background:#f0f0f0; padding:0.5rem; margin:0.25rem 0; word-break:break-all;"></p>
    <button type="button" id="copyDocker" style="margin:0.25rem 0; padding:0.25rem 0.5rem; display:none;">Copy command</button>
  </div>
  <script>
    var drop = document.getElementById('dropzone');
    var input = document.getElementById('imageRef');
    var modeSelect = document.getElementById('scanMode');
    var out = document.getElementById('cliCommand');
    var dockerOut = document.getElementById('dockerCommand');
    var copyCli = document.getElementById('copyCli');
    var copyDocker = document.getElementById('copyDocker');
    function updatePlaceholder() {
      var m = modeSelect.value;
      input.placeholder = m === 'image' ? 'e.g. alpine:3.10 or ghcr.io/org/image:tag' : m === 'lxc' ? 'e.g. mycontainer' : 'e.g. /var/lib/lxc/mycontainer/rootfs';
    }
    function setRef(ref) {
      ref = (ref || '').trim();
      input.value = ref;
      var m = modeSelect.value;
      var cli = '', docker = '';
      if (ref) {
        if (m === 'image') {
          cli = 'scanner scan --image ' + ref + ' --output-dir ./reports --format sarif,markdown,html,csv';
          docker = 'docker run --rm -v %CD%\\reports:/reports scanner:latest scan --image ' + ref + ' --output-dir /reports --format sarif,markdown,html,csv';
        } else if (m === 'lxc') {
          cli = 'scanner scan --lxc ' + ref + ' --output-dir ./reports --format sarif,markdown,html,csv';
          docker = 'docker run --rm -v /var/lib/lxc:/var/lib/lxc:ro -v %CD%\\reports:/reports scanner:latest scan --fs /var/lib/lxc/' + ref + '/rootfs --output-dir /reports --format sarif,markdown,html,csv';
        } else {
          cli = 'scanner scan --fs ' + ref + ' --output-dir ./reports --format sarif,markdown,html,csv';
          docker = 'docker run --rm -v ' + ref.replace(/\\/g, '/') + ':/fs:ro -v %CD%\\reports:/reports scanner:latest scan --fs /fs --output-dir /reports --format sarif,markdown,html,csv';
        }
      }
      out.textContent = cli ? 'Run: ' + cli : '';
      dockerOut.textContent = docker ? 'Run: ' + docker : '';
      copyCli.style.display = cli ? 'inline-block' : 'none';
      copyDocker.style.display = docker ? 'inline-block' : 'none';
      copyCli.dataset.text = cli;
      copyDocker.dataset.text = docker;
    }
    modeSelect.addEventListener('change', function() { updatePlaceholder(); setRef(input.value); });
    updatePlaceholder();
    drop.addEventListener('dragover', function(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'copy'; drop.style.background = '#e0f0ff'; });
    drop.addEventListener('dragleave', function() { drop.style.background = '#f0f8ff'; });
    drop.addEventListener('drop', function(e) {
      e.preventDefault();
      drop.style.background = '#f0f8ff';
      var t = e.dataTransfer.getData('text/plain') || (e.dataTransfer.files[0] && e.dataTransfer.files[0].name);
      if (t) setRef(t);
    });
    drop.addEventListener('click', function() { input.focus(); });
    input.addEventListener('input', function() { setRef(input.value); });
    copyCli.addEventListener('click', function() { if (copyCli.dataset.text) { navigator.clipboard.writeText(copyCli.dataset.text); copyCli.textContent = 'Copied!'; setTimeout(function() { copyCli.textContent = 'Copy command'; }, 1500); } });
    copyDocker.addEventListener('click', function() { if (copyDocker.dataset.text) { navigator.clipboard.writeText(copyDocker.dataset.text); copyDocker.textContent = 'Copied!'; setTimeout(function() { copyDocker.textContent = 'Copy command'; }, 1500); } });
  </script>
</body>
</html>
